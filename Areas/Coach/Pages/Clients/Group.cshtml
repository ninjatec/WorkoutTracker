@page "{id:int}"
@model WorkoutTrackerWeb.Areas.Coach.Pages.Clients.GroupModel
@{
    ViewData["Title"] = "Manage Client Group";
    Layout = "_Layout";
}

<div class="row mb-4">
    <div class="col-md-12">
        <div class="d-flex justify-content-between align-items-center">
            <h4><i class="bi bi-people-fill me-2"></i>@Model.GroupName</h4>
            <div>
                <a asp-page="./Index" class="btn btn-outline-secondary me-2">
                    <i class="bi bi-arrow-left me-1"></i>Back to Clients
                </a>
                <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#editGroupModal">
                    <i class="bi bi-pencil me-1"></i>Edit Group
                </button>
            </div>
        </div>
    </div>
</div>

@if (!string.IsNullOrEmpty(Model.StatusMessage))
{
    var statusClass = Model.StatusMessageType == "Success" ? "success" : "danger";
    <div class="alert alert-@statusClass alert-dismissible fade show" role="alert">
        @Model.StatusMessage
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
}

<div class="row">
    <div class="col-md-4">
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0">Group Details</h5>
            </div>
            <div class="card-body">
                <dl class="row">
                    <dt class="col-sm-4">Name</dt>
                    <dd class="col-sm-8">@Model.GroupName</dd>
                    
                    <dt class="col-sm-4">Description</dt>
                    <dd class="col-sm-8">@Model.GroupDescription</dd>
                    
                    <dt class="col-sm-4">Created</dt>
                    <dd class="col-sm-8">@Model.CreatedDate?.ToString("MMM d, yyyy")</dd>
                    
                    <dt class="col-sm-4">Members</dt>
                    <dd class="col-sm-8">@Model.MemberCount</dd>
                </dl>
            </div>
        </div>
        
        <div class="card mb-4">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0">Group Actions</h5>
            </div>
            <div class="card-body">
                <div class="d-grid gap-2">
                    <button type="button" class="btn btn-success" data-bs-toggle="modal" data-bs-target="#assignWorkoutModal">
                        <i class="bi bi-calendar-plus me-2"></i>Assign Template to Group
                    </button>
                    <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addMembersModal">
                        <i class="bi bi-person-plus me-2"></i>Add Members
                    </button>
                    <form method="post" asp-page-handler="DeleteGroup" onsubmit="return confirm('Are you sure you want to delete this group? This action cannot be undone.');">
                        <input type="hidden" name="groupId" value="@Model.GroupId" />
                        <button type="submit" class="btn btn-danger w-100">
                            <i class="bi bi-trash me-2"></i>Delete Group
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-8">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0">Group Members</h5>
                <button type="button" class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#addMembersModal">
                    <i class="bi bi-person-plus me-1"></i>Add Members
                </button>
            </div>
            <div class="card-body">
                @if (Model.Members.Any())
                {
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Email</th>
                                    <th>Added Date</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var member in Model.Members)
                                {
                                    <tr>
                                        <td>
                                            <a asp-page="./Details" asp-route-id="@member.ClientRelationshipId">@member.Name</a>
                                        </td>
                                        <td>@member.Email</td>
                                        <td>@member.AddedDate?.ToString("MMM d, yyyy")</td>
                                        <td>
                                            <form method="post" asp-page-handler="RemoveMember" class="d-inline">
                                                <input type="hidden" name="relationshipId" value="@member.ClientRelationshipId" />
                                                <input type="hidden" name="groupId" value="@Model.GroupId" />
                                                <button type="submit" class="btn btn-sm btn-outline-danger" title="Remove from group">
                                                    <i class="bi bi-person-dash"></i>
                                                </button>
                                            </form>
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                }
                else
                {
                    <div class="alert alert-info">
                        <i class="bi bi-info-circle me-2"></i>This group doesn't have any members yet.
                        <p class="mt-2">Use the 'Add Members' button to add clients to this group.</p>
                    </div>
                }
            </div>
        </div>
    </div>
</div>

<!-- Edit Group Modal -->
<div class="modal fade" id="editGroupModal" tabindex="-1" aria-labelledby="editGroupModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <form method="post" asp-page-handler="UpdateGroup">
                <div class="modal-header">
                    <h5 class="modal-title" id="editGroupModalLabel">Edit Group Details</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" name="groupId" value="@Model.GroupId" />
                    
                    <div class="mb-3">
                        <label for="groupName" class="form-label">Group Name</label>
                        <input type="text" class="form-control" id="groupName" name="groupName" value="@Model.GroupName" required>
                    </div>
                    
                    <div class="mb-3">
                        <label for="groupDescription" class="form-label">Description</label>
                        <textarea class="form-control" id="groupDescription" name="groupDescription" rows="3">@Model.GroupDescription</textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Changes</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Add Members Modal -->
<div class="modal fade" id="addMembersModal" tabindex="-1" aria-labelledby="addMembersModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <form method="post" asp-page-handler="AddMembers">
                <div class="modal-header">
                    <h5 class="modal-title" id="addMembersModalLabel">Add Members to Group</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" name="groupId" value="@Model.GroupId" />
                    
                    <div class="mb-3">
                        <label class="form-label">Select Clients to Add</label>
                        <div class="form-check client-list">
                            @if (Model.AvailableClients.Any())
                            {
                                @foreach (var client in Model.AvailableClients)
                                {
                                    <div class="form-check mb-2">
                                        <input class="form-check-input" type="checkbox" id="client@(client.RelationshipId)" name="selectedClients" value="@client.RelationshipId">
                                        <label class="form-check-label" for="client@(client.RelationshipId)">
                                            @client.Name (@client.Email)
                                        </label>
                                    </div>
                                }
                            }
                            else
                            {
                                <div class="alert alert-info">
                                    No more clients available to add to this group.
                                </div>
                            }
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-success" @(Model.AvailableClients.Any() ? "" : "disabled")>Add to Group</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Assign Template Modal -->
<div class="modal fade" id="assignWorkoutModal" tabindex="-1" aria-labelledby="assignWorkoutModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <form method="post" asp-page-handler="AssignTemplate">
                <div class="modal-header">
                    <h5 class="modal-title" id="assignWorkoutModalLabel">Assign Template to Group</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" name="groupId" value="@Model.GroupId" />
                    
                    <div class="mb-3">
                        <label for="templateId" class="form-label">Select Template</label>
                        <select class="form-select" id="templateId" name="templateId" required>
                            <option value="">-- Select Template --</option>
                            @foreach (var template in Model.AvailableTemplates)
                            {
                                <option value="@template.TemplateId">@template.Name</option>
                            }
                        </select>
                    </div>
                    
                    <div class="mb-3">
                        <label for="assignmentName" class="form-label">Assignment Name</label>
                        <input type="text" class="form-control" id="assignmentName" name="assignmentName" required>
                        <small class="text-muted">A descriptive name for this assignment (e.g. "Summer Strength Program")</small>
                    </div>
                    
                    <div class="mb-3">
                        <label for="notes" class="form-label">Notes</label>
                        <textarea class="form-control" id="notes" name="notes" rows="3"></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-success">Assign to Group</button>
                </div>
            </form>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function() {
            // Initialize any client-side functionality specific to group management here
        });
    </script>
}